{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "metadata": {
        "title": "",
        "description": "",
        "prerequisites": "",
    "postDeployment": [],
    "prerequisitesDeployTemplateFile": "",
    "lastUpdateTime": "",
"entities": [],
"tags": [],
"support": {
"tier": "community",
"armtemplate": "Generated"
},
"author": {
"name": ""
}
},
"parameters": {
"PlaybookName": {
"defaultValue": "Module-CreateWatchlist",
"type": "string"
}
},
"variables": {},
"resources": [
{
"properties": {
"provisioningState": "Succeeded",
"state": "Enabled",
"definition": {
    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "$connections": {
        "defaultValue": {},
        "type": "Object"
    }
},
"triggers": {
    "When_a_HTTP_request_is_received": {
        "type": "Request",
        "kind": "Http",
        "inputs": {
            "schema": {
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "displayName": {
                        "type": "string"
                    },
                    "itemsSearchKey": {
                        "type": "string"
                    },
                    "rawContent": {
                        "type": "string"
                    },
                    "source": {
                        "type": "string"
                    },
                    "subscriptionId": {
                        "type": "string"
                    },
                    "resourceGroup": {
                        "type": "string"
                    },
                    "workspaceId": {
                        "type": "string"
                    },
                    "watchlistAlias": {
                        "type": "string"
                    }
                },
                "type": "object"
            }
        }
    }
},
"actions": {
    "Response": {
        "runAfter": {
            "Watchlists_-_Create_a_new_Watchlist_with_data_(Raw_Content)": [
                "Succeeded"
            ]
        },
        "type": "Response",
        "kind": "Http",
        "inputs": {
            "statusCode": 200
        }
    },
    "Watchlists_-_Create_a_new_Watchlist_with_data_(Raw_Content)": {
    "runAfter": {},
    "type": "ApiConnection",
    "inputs": {
        "host": {
            "connection": {
                "name": "@parameters('$connections')['MicrosoftSentinel']['connectionId']"
            }
        },
        "method": "put",
        "body": {
            "description": "@{triggerBody()?['description']}",
            "displayName": "@{triggerBody()?['displayName']}",
            "itemsSearchKey": "@{triggerBody()?['itemsSearchKey']}",
            "rawContent": "@triggerBody()?['rawContent']",
            "source": "@{triggerBody()?['source']}"
        },
        "path": "/Watchlists/subscriptions/@{encodeURIComponent(triggerBody()?['subscriptionId'])}/resourceGroups/@{encodeURIComponent(triggerBody()?['resourceGroup'])}/workspaces/@{encodeURIComponent(triggerBody()?['workspaceId'])}/watchlists/@{encodeURIComponent(triggerBody()?['watchlistAlias'])}"
    }
}
},
"outputs": {}
},
"parameters": {
"$connections": {
"value": {
"MicrosoftSentinel": {
    "connectionId": "/subscriptions/5305ccd2-977a-4630-843b-bad582e756a3/resourceGroups/STL-SEC-AUTOMATION-RG/providers/Microsoft.Web/connections/Microsoftsentinel-Module-CreateWatchlist",
    "connectionName": "Microsoftsentinel-Module-CreateWatchlist",
    "id": "/subscriptions/5305ccd2-977a-4630-843b-bad582e756a3/providers/Microsoft.Web/locations/uksouth/managedApis/Microsoftsentinel",
    "connectionProperties": {
        "authentication": {
            "type": "ManagedServiceIdentity"
        }
    }
}
}
}
},
"accessControl": {
"triggers": {
"allowedCallerIpAddresses": []
},
"actions": {
"allowedCallerIpAddresses": []
}
}
},
"name": "[parameters('PlaybookName')]",
"type": "Microsoft.Logic/workflows",
"location": "[resourceGroup().location]",
"tags": {
"Environment": "Azure",
"Application": "Microsoft Sentinel",
"Purpose": "Microsoft Sentinel Watchlist",
"hidden-SentinelTemplateName": "Module-CreateWatchlist",
"hidden-SentinelTemplateVersion": "1.0"
},
"identity": {
"type": "SystemAssigned"
},
"apiVersion": "2017-07-01",
"dependsOn": []
}
]
}
